<html>
<head>
<script>
    function response_callback(response, elem) {
        var status = document.getElementById(elem);
        if (elem == "Battery") {
            response = response.charCodeAt() / 10.0 + "V";
            setSensorValue("INF7", response);
        }
        status.innerHTML = elem + ": " + response;
    }
    function request(cmd, elem="Status") {
        var req = new XMLHttpRequest();
        req.open('GET', 'cgi-bin/request.py?cmd='+cmd, true);
        req.onload = function() {
            if (req.status == 200) {
                response_callback(req.responseText, elem);
            }
        }
        req.send(null);
    }
    function setSensorValue(sensor, value) {
        var a = document.getElementById("sensor_svg");
        var svg = a.contentDocument;
        var item = svg.getElementById(sensor);
        item.innerHTML = value;
    }
    var tick = 0;
    function timeout_callback() {
        for(var i=1; i<=6; i++) {
            //setSensorValue("INF" + i, tick * 10 + i);
        }
        tick += 1;
        request("A", "Battery");
        setTimeout("timeout_callback();", 10000);
    }
    function main() {
        timeout_callback();
    }
</script>
<style>
    .inverse { transform: scale(1, -1); }
</style>
</head>  
<body onload="main();">
    <table>
        <tr>
        <td>
            <div id="camera">
            <img src="http://192.168.0.83:8080/stream.mjpg" width="640" height="480" class="inverse"/>
            </div>
        </td>
        <td bordercolor="black" style="border-collapse: collapse; border: 2px solid black;" align="left">
            <div id="sensors">
                <object id="sensor_svg" data="sensors.svg" width="600" height="460" type="image/svg+xml">
                </object>
            </div>
	    <div id="Status">
	        Status:
	    </div>
        </td>
        </tr>
    </table>
</body>
</html>
